<!doctype html>
<html lang="en">
<head>
    <title>Code coverage report for node-npmtest-oneapm/node_modules/oneapm/lib/metrics/normalizer.js</title>
    <meta charset="utf-8">
    <style>
        body, html {
            margin:0; padding: 0;
        }
        body {
            font-family: Arial, Helvetica;
            font-size: 10pt;
        }
        div.header, div.footer {
            background: #eee;
            padding: 1em;
        }
        div.header {
            height: 160px;
            padding: 0 1em 0 1em;
            z-index: 100;
            position: fixed;
            top: 0;
            border-bottom: 1px solid #666;
            width: 100%;
        }
        div.footer {
            border-top: 1px solid #666;
        }
        div.body {
            margin-top: 170px;
        }
        div.meta {
            font-size: 90%;
            text-align: center;
        }
        h1, h2, h3 {
            font-weight: normal;
        }
        h1 {
            font-size: 12pt;
        }
        h2 {
            font-size: 10pt;
        }
        pre {
            font-family: Menlo, Monaco, Consolas, Courier New, monospace;
            margin: 0;
            padding: 0;
            font-size: 14px;
            tab-size: 2;
        }

        div.path { font-size: 110%; }
        div.path a:link, div.path a:visited { color: #000; }
        table.coverage { border-collapse: collapse; margin:0; padding: 0 }

        table.coverage td {
            margin: 0;
            padding: 0;
            color: #111;
            vertical-align: top;
        }
        table.coverage td.line-count {
            width: 50px;
            text-align: right;
            padding-right: 5px;
        }
        table.coverage td.line-coverage {
            color: #777 !important;
            text-align: right;
            border-left: 1px solid #666;
            border-right: 1px solid #666;
        }

        table.coverage td.text {
        }

        table.coverage td span.cline-any {
            display: inline-block;
            padding: 0 5px;
            width: 40px;
        }
        table.coverage td span.cline-neutral {
            background: #eee;
        }
        table.coverage td span.cline-yes {
            background: #b5d592;
            color: #999;
        }
        table.coverage td span.cline-no {
            background: #fc8c84;
        }

        .cstat-yes { color: #111; }
        .cstat-no { background: #fc8c84; color: #111; }
        .fstat-no { background: #ffc520; color: #111 !important; }
        .cbranch-no { background:  yellow !important; color: #111; }

        .cstat-skip { background: #ddd; color: #111; }
        .fstat-skip { background: #ddd; color: #111 !important; }
        .cbranch-skip { background: #ddd !important; color: #111; }

        .missing-if-branch {
            display: inline-block;
            margin-right: 10px;
            position: relative;
            padding: 0 4px;
            background: black;
            color: yellow;
        }

        .skip-if-branch {
            display: none;
            margin-right: 10px;
            position: relative;
            padding: 0 4px;
            background: #ccc;
            color: white;
        }

        .missing-if-branch .typ, .skip-if-branch .typ {
            color: inherit !important;
        }

        .entity, .metric { font-weight: bold; }
        .metric { display: inline-block; border: 1px solid #333; padding: 0.3em; background: white; }
        .metric small { font-size: 80%; font-weight: normal; color: #666; }

        div.coverage-summary table { border-collapse: collapse; margin: 3em; font-size: 110%; }
        div.coverage-summary td, div.coverage-summary table  th { margin: 0; padding: 0.25em 1em; border-top: 1px solid #666; border-bottom: 1px solid #666; }
        div.coverage-summary th { text-align: left; border: 1px solid #666; background: #eee; font-weight: normal; }
        div.coverage-summary th.file { border-right: none !important; }
        div.coverage-summary th.pic { border-left: none !important; text-align: right; }
        div.coverage-summary th.pct { border-right: none !important; }
        div.coverage-summary th.abs { border-left: none !important; text-align: right; }
        div.coverage-summary td.pct { text-align: right; border-left: 1px solid #666; }
        div.coverage-summary td.abs { text-align: right; font-size: 90%; color: #444; border-right: 1px solid #666; }
        div.coverage-summary td.file { text-align: right; border-left: 1px solid #666; white-space: nowrap;  }
        div.coverage-summary td.pic { min-width: 120px !important;  }
        div.coverage-summary a:link { color: #000; }
        div.coverage-summary a:visited { color: #333; }
        div.coverage-summary tfoot td { border-top: 1px solid #666; }

        div.coverage-summary .yui3-datatable-sort-indicator, div.coverage-summary .dummy-sort-indicator {
            height: 10px;
            width: 7px;
            display: inline-block;
            margin-left: 0.5em;
        }
        div.coverage-summary .yui3-datatable-sort-indicator {
            background: no-repeat scroll 0 0 transparent;
        }
        div.coverage-summary .yui3-datatable-sorted .yui3-datatable-sort-indicator {
            background-position: 0 -20px;
        }
        div.coverage-summary .yui3-datatable-sorted-desc .yui3-datatable-sort-indicator {
            background-position: 0 -10px;
        }

        .high { background: #b5d592 !important; }
        .medium { background: #ffe87c !important; }
        .low { background: #fc8c84 !important; }

        span.cover-fill, span.cover-empty {
            display:inline-block;
            border:1px solid #444;
            background: white;
            height: 12px;
        }
        span.cover-fill {
            background: #ccc;
            border-right: 1px solid #444;
        }
        span.cover-empty {
            background: white;
            border-left: none;
        }
        span.cover-full {
            border-right: none !important;
        }
        pre.prettyprint {
            border: none !important;
            padding: 0 !important;
            margin: 0 !important;
        }
        .com { color: #999 !important; }
        .ignore-none { color: #999; font-weight: normal; }

    </style>
</head>
<body>
<div class="header low">
    <h1 style="font-weight: bold;">
        <a href="https://github.com/npmtest/node-npmtest-oneapm">npmtest-oneapm (v0.0.1)</a>
    </h1>
    <h1>Code coverage report for <span class="entity">node-npmtest-oneapm/node_modules/oneapm/lib/metrics/normalizer.js</span></h1>
    <h2>
        
        Statements: <span class="metric">4.88% <small>(4 / 82)</small></span> &nbsp;&nbsp;&nbsp;&nbsp;
        
        
        Branches: <span class="metric">0% <small>(0 / 46)</small></span> &nbsp;&nbsp;&nbsp;&nbsp;
        
        
        Functions: <span class="metric">0% <small>(0 / 14)</small></span> &nbsp;&nbsp;&nbsp;&nbsp;
        
        
        Lines: <span class="metric">5.33% <small>(4 / 75)</small></span> &nbsp;&nbsp;&nbsp;&nbsp;
        
        Ignored: <span class="metric"><span class="ignore-none">none</span></span> &nbsp;&nbsp;&nbsp;&nbsp;
    </h2>
    <div class="path"><a href="../../../../../index.html">All files</a> &#187; <a href="index.html">node-npmtest-oneapm/node_modules/oneapm/lib/metrics/</a> &#187; normalizer.js</div>
</div>
<div class="body">
<pre><table class="coverage">
<tr><td class="line-count">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219</td><td class="line-coverage"><span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js">'use strict';
&nbsp;
var path      = require('path')
  , logger    = require('oneapm-logger')
                  .child({component : 'metric_normalizer'})
  , deepEqual = require('../util/deep-equal')
  , Rule      = require('./normalizer/rule')
  , NAMES     = require('../metrics/names.js')
  ;
&nbsp;
&nbsp;
<span class="fstat-no" title="function not covered" >function url(normalized, path, config) {</span>
<span class="cstat-no" title="statement not covered" >  if (normalized) <span class="cstat-no" title="statement not covered" >return NAMES.NORMALIZED + normalized;</span></span>
&nbsp;
<span class="cstat-no" title="statement not covered" >  if (config.enforce_backstop) {</span>
<span class="cstat-no" title="statement not covered" >    return NAMES.NORMALIZED + '/*';</span>
  }
  else {
<span class="cstat-no" title="statement not covered" >    return NAMES.URI + path;</span>
  }
}
&nbsp;
<span class="fstat-no" title="function not covered" >function plain(normalized, path) {</span>
<span class="cstat-no" title="statement not covered" >  if (normalized) {</span>
<span class="cstat-no" title="statement not covered" >    return normalized;</span>
  }
  else {
<span class="cstat-no" title="statement not covered" >    return path;</span>
  }
}
&nbsp;
/**
 * The collector keeps track of rules that should be applied to metric names,
 * and sends these rules to the agent at connection time. These rules can
 * either change the name of the metric or indicate that metrics associated with
 * this name (which is generally a URL path) should be ignored altogether.
 *
 * @param {object} config The agent's configuration blob, which has a parameter
 *                        that indicates whether to enforce the normalization
 *                        backstop.
 */
<span class="fstat-no" title="function not covered" >function MetricNormalizer(config, type) {</span>
<span class="cstat-no" title="statement not covered" >  if (!config) <span class="cstat-no" title="statement not covered" >throw new Error("normalizer must be created with configuration.");</span></span>
<span class="cstat-no" title="statement not covered" >  if (!type) <span class="cstat-no" title="statement not covered" >throw new Error("normalizer must be created with a type.");</span></span>
&nbsp;
<span class="cstat-no" title="statement not covered" >  this.config = config;</span>
<span class="cstat-no" title="statement not covered" >  this.type = type;</span>
  // some mildly cheesy polymorphism to make normalizers work generically
<span class="cstat-no" title="statement not covered" >  if (type === 'URL') {</span>
<span class="cstat-no" title="statement not covered" >    this.formatter = url;</span>
  }
  else {
<span class="cstat-no" title="statement not covered" >    this.formatter = plain;</span>
  }
&nbsp;
<span class="cstat-no" title="statement not covered" >  this.rules = [];</span>
}
&nbsp;
/**
 * Convert the raw, deserialized JSON response into a set of
 * NormalizationRules.
 *
 * @param object json The deserialized JSON response sent on collector
 *                    connection.
 */
<span class="cstat-no" title="statement not covered" >MetricNormalizer.prototype.load = <span class="fstat-no" title="function not covered" >function load(json) {</span></span>
<span class="cstat-no" title="statement not covered" >  if (json) {</span>
<span class="cstat-no" title="statement not covered" >    logger.debug("Received %s %s normalization rule(s)", json.length, this.type);</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >    json.forEach(<span class="fstat-no" title="function not covered" >function cb_forEach(ruleJSON) {</span></span>
<span class="cstat-no" title="statement not covered" >      var rule = new Rule(ruleJSON);</span>
      // no need to add the same rule twice
<span class="cstat-no" title="statement not covered" >      if (!this.rules.some(<span class="fstat-no" title="function not covered" >function cb_some(r) {</span> <span class="cstat-no" title="statement not covered" >return deepEqual(r, rule); </span>})) {</span>
<span class="cstat-no" title="statement not covered" >        this.rules.push(rule);</span>
      }
    }, this);
&nbsp;
    /* I (FLN) always forget this, so making a note: JS sort is always
     * IN-PLACE, even though it returns the sorted array.
     */
<span class="cstat-no" title="statement not covered" >    this.rules.sort(<span class="fstat-no" title="function not covered" >function cb_sort(a, b) {</span> <span class="cstat-no" title="statement not covered" >return a.precedence - b.precedence; </span>});</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >    logger.debug("Normalized to %s %s normalization rule(s).",</span>
                 this.rules.length, this.type);
  }
};
&nbsp;
/**
 * Load any rules found in the configuration into a metric normalizer.
 *
 * Operates via side effects.
 */
<span class="cstat-no" title="statement not covered" >MetricNormalizer.prototype.loadFromConfig = <span class="fstat-no" title="function not covered" >function loadFromConfig() {</span></span>
<span class="cstat-no" title="statement not covered" >  var rules = this.config.rules;</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >  if (rules &amp;&amp; rules.name &amp;&amp; rules.name.length &gt; 0) {</span>
<span class="cstat-no" title="statement not covered" >    rules.name.forEach(<span class="fstat-no" title="function not covered" >function cb_forEach(rule) {</span></span>
<span class="cstat-no" title="statement not covered" >      if (!rule.pattern) {</span>
<span class="cstat-no" title="statement not covered" >        return logger.error({rule : rule},</span>
                            "Simple naming rules require a pattern.");
      }
<span class="cstat-no" title="statement not covered" >      if (!rule.name) {</span>
<span class="cstat-no" title="statement not covered" >        return logger.error({rule : rule},</span>
                            "Simple naming rules require a replacement name.");
      }
&nbsp;
<span class="cstat-no" title="statement not covered" >      this.addSimple(rule.pattern, rule.name);</span>
    }, this);
  }
&nbsp;
<span class="cstat-no" title="statement not covered" >  if (rules &amp;&amp; rules.ignore &amp;&amp; rules.ignore.length &gt; 0) {</span>
<span class="cstat-no" title="statement not covered" >    rules.ignore.forEach(<span class="fstat-no" title="function not covered" >function cb_forEach(pattern) {</span> <span class="cstat-no" title="statement not covered" >this.addSimple(pattern); </span>}, this);</span>
  }
};
&nbsp;
/**
 * Add simple, user-provided rules to the head of the match list. These rules
 * will always be highest precedence, always will terminate matching, and
 * will always apply to the URL as a whole. If no name is provided, then
 * transactions attached to the matching URLs will be ignored.
 *
 * @param {RegExp} pattern The pattern to rename (with capture groups).
 * @param {string} name    The name to use for the transaction.
 */
<span class="cstat-no" title="statement not covered" >MetricNormalizer.prototype.addSimple = <span class="fstat-no" title="function not covered" >function addSimple(pattern, name) {</span></span>
<span class="cstat-no" title="statement not covered" >  if (!pattern) <span class="cstat-no" title="statement not covered" >return logger.error("Simple naming rules require a pattern.");</span></span>
&nbsp;
<span class="cstat-no" title="statement not covered" >  var json = {</span>
    match_expression : pattern,
    terminate_chain  : true
  };
&nbsp;
<span class="cstat-no" title="statement not covered" >  if (name) {</span>
<span class="cstat-no" title="statement not covered" >    json.replacement = name;</span>
  }
  else {
<span class="cstat-no" title="statement not covered" >    json.ignore = true;</span>
  }
&nbsp;
<span class="cstat-no" title="statement not covered" >  this.rules.unshift(new Rule(json));</span>
};
&nbsp;
/**
 * Test whether a URL path should be ignored.
 *
 * @param {string} path The URL path to test.
 *
 * @returns {boolean} Whether or not to ignore the path.
 */
<span class="cstat-no" title="statement not covered" >MetricNormalizer.prototype.isIgnored = <span class="fstat-no" title="function not covered" >function isIgnored(path) {</span></span>
<span class="cstat-no" title="statement not covered" >  var length = this.rules.length;</span>
<span class="cstat-no" title="statement not covered" >  for (var i = 0; i &lt; length; i++) {</span>
<span class="cstat-no" title="statement not covered" >    var rule = this.rules[i];</span>
<span class="cstat-no" title="statement not covered" >    if (rule.ignore &amp;&amp; rule.matches(path)) {</span>
<span class="cstat-no" title="statement not covered" >      logger.trace("Ignoring %s because of rule: %j", path, rule);</span>
      // prevent deoptimization
<span class="cstat-no" title="statement not covered" >      return true;</span>
    }
  }
&nbsp;
<span class="cstat-no" title="statement not covered" >  return false;</span>
};
&nbsp;
/**
 * Test whether a URL path will be normalized.
 *
 * @param {string} path The URL path to test.
 *
 * @returns {boolean} Whether or not any normalization rules match.
 */
<span class="cstat-no" title="statement not covered" >MetricNormalizer.prototype.isNormalized = <span class="fstat-no" title="function not covered" >function isNormalized(path) {</span></span>
<span class="cstat-no" title="statement not covered" >  var length = this.rules.length;</span>
<span class="cstat-no" title="statement not covered" >  for (var i = 0; i &lt; length; i++) {</span>
<span class="cstat-no" title="statement not covered" >    var rule = this.rules[i];</span>
<span class="cstat-no" title="statement not covered" >    if (!rule.ignore &amp;&amp; rule.matches(path)) {</span>
<span class="cstat-no" title="statement not covered" >      logger.trace("Normalizing %s because of rule: %j", path, rule);</span>
      // prevent deoptimization
<span class="cstat-no" title="statement not covered" >      return true;</span>
    }
  }
&nbsp;
<span class="cstat-no" title="statement not covered" >  return false;</span>
};
&nbsp;
&nbsp;
/**
 * Turn a (scrubbed) URL path into partial metric name.
 *
 * @param {string} path The URL path to turn into a name.
 *
 * @returns {string} The normalized name.
 */
<span class="cstat-no" title="statement not covered" >MetricNormalizer.prototype.normalize = <span class="fstat-no" title="function not covered" >function normalize(path) {</span></span>
<span class="cstat-no" title="statement not covered" >  var last   = path</span>
    , length = this.rules.length
    , normalized
    ;
&nbsp;
<span class="cstat-no" title="statement not covered" >  for (var i = 0; i &lt; length; i++) {</span>
<span class="cstat-no" title="statement not covered" >    var rule = this.rules[i];</span>
<span class="cstat-no" title="statement not covered" >    if (rule.matches(last)) {</span>
<span class="cstat-no" title="statement not covered" >      normalized = rule.apply(last);</span>
<span class="cstat-no" title="statement not covered" >      logger.trace("Normalized %s to %s because of rule: %j", last, normalized, rule);</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >      if (rule.isTerminal) {</span>
<span class="cstat-no" title="statement not covered" >        logger.trace("Terminating normalization because of rule: %j", rule);</span>
<span class="cstat-no" title="statement not covered" >        break;</span>
      }
&nbsp;
<span class="cstat-no" title="statement not covered" >      last = normalized;</span>
    }
  }
&nbsp;
<span class="cstat-no" title="statement not covered" >  return this.formatter(normalized, path, this.config);</span>
};
&nbsp;
<span class="cstat-no" title="statement not covered" >module.exports = MetricNormalizer;</span>
&nbsp;
&nbsp;</pre></td></tr>
</table></pre>
</div>
<div class="footer">
    <div class="meta">Generated by <a href="https://github.com/kaizhu256/node-utility2" target="_blank">utility2</a> at Tue Apr 25 2017 02:35:29 GMT+0000 (UTC)</div>
</div>
</body>
</html>
